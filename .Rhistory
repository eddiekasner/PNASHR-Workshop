severeinjuries <- fread("https://www.osha.gov/severeinjury/xml/severeinjury.csv")
#use p_load to install and load new packages
p_load(data.table)
p_load(bit64)
#use p_load to install and load new packages
p_load(data.table)
library(pacman)
#use p_load to install and load new packages
p_load(data.table)
p_load(bit64)
p_load(readxl)
severeinjuries <- fread("https://www.osha.gov/severeinjury/xml/severeinjury.csv")
naics <- read_excel("Data/2012_NAICS_Structure.xls", skip = 2)
#create data table
naics <- setDT(na)
#create data table
naics <- setDT(naics)
setkey(severeinjuries, "Primary NAICS")
setkey(naics, "2012 NAICS Code")
severeinjuries <- naics[severeinjuries]
severeinjuries
grep("^11", "11212")
grep("^11", c("11212", "2122")
)
grep("^11", c("11212", "2122"))
grep("^[\S]{4}", 3333)
grep("^[\\S]{4}", 3333)
grep("^[\\S]{4}", "3333")
naics
naics[(grep"^11", `2012 NAICS Code`)]
naics[(grep("^11", `2012 NAICS Code`)]
naics[(grep("^11", `2012 NAICS Code`),]
naics[(grep("^11", `2012 NAICS Code`),]
grep("^11", naics$`2012 NAICS Code`)
naics[grep("^11", naics$`2012 NAICS Code`),]
View(naics[grep("^11", naics$`2012 NAICS Code`),])
View(naics[grep("^1130", naics$`2012 NAICS Code`),])
View(naics[grep("^113", naics$`2012 NAICS Code`),])
grep("^11", c("112120", "411532"))
grep("^11", c("112120", "411532"))
grep("^11", c("112120", "411532"), value = T)
severeinjuries[grep("^11", `2012 NAICS Code`),]
names(severeinjuries)
summary(severeinjuries)
severeinjuries_ag$EventDate
severeinjuries_ag =
severeinjuries[grep("^11", `2012 NAICS Code`),]
severeinjuries_ag$EventDate
severinjuries[, EventDate := as.POSXIXct(EventDate, "%m/%d/%Y")]
severeinjuries[, EventDate := as.POSXIXct(EventDate, "%m/%d/%Y")]
severeinjuries[, EventDate := as.POSIXct(EventDate, "%m/%d/%Y")]
severeinjuries$EventDate
typeof(severeinjuries$EventDate)
severeinjuries[, EventDate :=
as.POSIXct(EventDate, "%m/%d/%Y")]
?parse_date
?lubridate
?parse_date_time
??parse_date_time
#create date variable
p_load(lubridate)
severeinjuries[, EventDate :=
parse_date_time(EventDate, "mdY")]
severeinjuries
severeinjuries$EventDate
severeinjuries[, Year :=
year(EventDate)]
severeinjuries
severeinjuries[, Month :=
month(EventDate)]
#create data table
naics <- setDT(naics)
setkey(severeinjuries, "Primary NAICS")
setkey(naics, "2012 NAICS Code")
severeinjuries <- naics[severeinjuries]
naics <- read_excel("Data/2012_NAICS_Structure.xls", skip = 2)
#create date variable
p_load(lubridate)
severeinjuries[, EventDate :=
parse_date_time(EventDate, "mdY")]
severeinjuries[, Year :=
year(EventDate)]
severeinjuries[, Month :=
month(EventDate)]
severeinjuries
severeinjuries <- fread("https://www.osha.gov/severeinjury/xml/severeinjury.csv")
naics <- read_excel("Data/2012_NAICS_Structure.xls", skip = 2)
#create date variable
p_load(lubridate)
severeinjuries[, EventDate :=
parse_date_time(EventDate, "mdY")]
severeinjuries[, Year :=
year(EventDate)]
severeinjuries[, Month :=
month(EventDate)]
#create data table
naics <- setDT(naics)
setkey(severeinjuries, "Primary NAICS")
fwrite(severeinjuries, "Data/SevereInjuries20201021.csv")
severeinjuries
#create data table
naics <- setDT(naics)
setkey(severeinjuries, "Primary NAICS")
setkey(naics, "2012 NAICS Code")
severeinjuries <- naics[severeinjuries]
grep("^11", c("112120", "411532"))
#This returns the value that matches
grep("^11", c("112120", "411532"), value = T)
severeinjuries_ag =
severeinjuries[grep("^11", `2012 NAICS Code`),]
severeinjuries_ag
table1(~Hospitalized + Amputation |Year  , severeinjuries_ag)
#Descriptive table
p_load(table1)
table1(~Hospitalized + Amputation |Year  , severeinjuries_ag)
?table1
with(stats.default(x),
sprintf("%0.2f (%0.1f)", SUM))
my.render.cont <- function(x) {
with(stats.default(x),
sprintf("%0.2f (%0.1f)", SUM))
}
table1(~Hospitalized + Amputation |Year  ,
severeinjuries_ag,
render.continuous = sum)
names(severeinjuries_ag)
summary(severeinjuries_ag)
table1(~ as.factor(Hospitalized) + Amputation |Year  ,
severeinjuries_ag,
render.continuous = sum)
severeinjuries_ag[, Hospitalized = as.factor(Hospitalized)]
severeinjuries_ag[, Hospitalized := as.factor(Hospitalized)]
severeinjuries_ag[, Amputation := as.factor(Amputation)]
table1(~ Hospitalized + Amputation |Year  ,
severeinjuries_ag,
render.continuous = sum)
table1(~ Hospitalized + Amputation |Year  ,
severeinjuries_ag)
|
table1(Hospitalized + Amputation |Year  ,
severeinjuries_ag)
table1(~ Hospitalized + Amputation |Year  ,
data = severeinjuries_ag)
severeinjuries_ag[, Hospitalized :=
as.factor(Hospitalized, labels = c("No","Yes","Unknown"))]
?as.factor
severeinjuries_ag[, Hospitalized :=
as.factor(Hospitalized,
labels = c("No","Yes","Unknown"))]
severeinjuries_ag =
severeinjuries[grep("^11", `2012 NAICS Code`),]
severeinjuries_ag[, Hospitalized :=
as.factor(Hospitalized,
labels = c("No","Yes","Unknown"))]
severeinjuries_ag[, Hospitalized :=
as.factor(Hospitalized,
levels = c("No","Yes","Unknown"))]
severeinjuries_ag[, Hospitalized :=
factor(Hospitalized,
levels = c("No","Yes","Unknown"))]
severeinjuries_ag$Hospitalized
severeinjuries_ag =
severeinjuries[grep("^11", `2012 NAICS Code`),]
severeinjuries_ag[, Hospitalized :=
factor(Hospitalized,
labels = c("No","Yes","Unknown"))]
severeinjuries_ag
severeinjuries_ag$Hospitalized
severeinjuries_ag[, Amputation :=
factor(Amputation,
labels = c("No","Yes","Unknown"))]
table1(~ Hospitalized + Amputation |Year  ,
data = severeinjuries_ag)
table1(~ Hospitalized + Amputation | as.factor(Year)  ,
data = severeinjuries_ag)
37+138
157+50
table1(~ Hospitalized * Amputation | Year  ,
data = severeinjuries_ag)
?table1
table1(~ Hospitalized*Amputation | Year  ,
data = severeinjuries_ag)
table1(~ Hospitalized + Amputation | Year  ,
data = severeinjuries_ag)
table1(~ Hospitalized  | Year  ,
data = severeinjuries_ag)
40+149
table1(~ Hospitalized  + Amputations | Year  ,
data = severeinjuries_ag)
table1(~ Hospitalized  + Amputation | Year  ,
data = severeinjuries_ag)
names(severeinjuries_ag)
leaflet(severeinjuries_ag) %>%
addProviderTiles(providers$CartoDB.DarkMatter) %>%
setView( 178, -20, 5 ) %>%
addHeatmap(
lng = ~Longitude, lat = ~Latitude,
blur = 20, max = 0.05, radius = 15
)
#plot events
p_load(leaflet)
leaflet(severeinjuries_ag) %>%
addProviderTiles(providers$CartoDB.DarkMatter) %>%
setView( 178, -20, 5 ) %>%
addHeatmap(
lng = ~Longitude, lat = ~Latitude,
blur = 20, max = 0.05, radius = 15
)
#plot events
p_load(leafletR)
leaflet(severeinjuries_ag) %>%
addProviderTiles(providers$CartoDB.DarkMatter) %>%
setView( 178, -20, 5 ) %>%
addHeatmap(
lng = ~Longitude, lat = ~Latitude,
blur = 20, max = 0.05, radius = 15
)
p_load(leaflet.extras)
#plot events
p_load(leaflet)
p_load(leaflet.extras)
leaflet(severeinjuries_ag) %>%
addProviderTiles(providers$CartoDB.DarkMatter) %>%
setView( 178, -20, 5 ) %>%
addHeatmap(
lng = ~Longitude, lat = ~Latitude,
blur = 20, max = 0.05, radius = 15
)
severeinjuries_ag
severeinjuries_ag$Latitude
severeinjuries_ag$Longitude
leaflet(severeinjuries_ag) %>%
addProviderTiles(providers$CartoDB.DarkMatter)
View(v)
View(severeinjuries_ag)
?read_excel
naics <- read_excel("Data/2012_NAICS_Structure.xls", skip = 2)
naics
naics$`Change Indicator` = NULL
naics
severeinjuries <- fread("https://www.osha.gov/severeinjury/xml/severeinjury.csv")
naics <- read_excel("Data/2012_NAICS_Structure.xls", skip = 2)
naics$`Change Indicator` = NULL
#create date variable
p_load(lubridate)
severeinjuries[, EventDate :=
parse_date_time(EventDate, "mdY")]
severeinjuries[, Year :=
year(EventDate)]
severeinjuries[, Month :=
month(EventDate)]
#create data table
naics <- setDT(naics)
setkey(severeinjuries, "Primary NAICS")
setkey(naics, "2012 NAICS Code")
severeinjuries <- naics[severeinjuries]
grep("^11", c("112120", "411532"))
#This returns the value that matches
grep("^11", c("112120", "411532"), value = T)
severeinjuries_ag =
severeinjuries[grep("^11", `2012 NAICS Code`),]
severeinjuries_ag[, Hospitalized :=
factor(Hospitalized,
labels = c("No","Yes","Unknown"))]
severeinjuries_ag[, Amputation :=
factor(Amputation,
labels = c("No","Yes","Unknown"))]
table1(~ Hospitalized  + Amputation | Year  ,
data = severeinjuries_ag)
#plot events
p_load(leaflet)
p_load(leaflet.extras)
leaflet(severeinjuries_ag) %>%
addProviderTiles(providers$CartoDB.DarkMatter) %>%
setView( 178, -20, 5 ) %>%
addHeatmap(
lng = ~Longitude, lat = ~Latitude,
blur = 20, max = 0.05, radius = 15
)
leaflet() %>%
addProviderTiles(providers$CartoDB.DarkMatter) %>%
setView( 178, -20, 5 ) %>%
addHeatmap(data = severeinjuries_ag,
lng = ~Longitude, lat = ~Latitude,
blur = 20, max = 0.05, radius = 15
)
leaflet() %>%
addProviderTiles(providers$CartoDB.DarkMatter)
leaflet() %>%
addProviderTiles(`CartoDB.DarkMatter`) %>%
addHeatmap(data = severeinjuries_ag,
lng = ~Longitude, lat = ~Latitude,
blur = 20, max = 0.05, radius = 15
)
?addProviderTiles
leaflet() %>%
addProviderTiles("CartoDB.DarkMatter") %>%
addHeatmap(data = severeinjuries_ag,
lng = ~Longitude, lat = ~Latitude,
blur = 20, max = 0.05, radius = 15
)
leaflet() %>%
addProviderTiles("CartoDB.DarkMatter")
leaflet() %>%
addProviderTiles("Stamen.TonerHybrid") %>%
addHeatmap(data = severeinjuries_ag,
lng = ~Longitude, lat = ~Latitude,
blur = 20, max = 0.05, radius = 15
)
leaflet() %>%
addProviderTiles("Stamen.TonerHybrid") %>%
addHeatmap(data = severeinjuries_ag,
lng = ~Longitude, lat = ~Latitude,
radius = 15
)
severeinjuries_ag %>%
leaflet() %>%
addProviderTiles("Stamen.TonerHybrid") %>%
addHeatmap(data = severeinjuries_ag,
lng = ~Longitude, lat = ~Latitude,
radius = 15
)
severeinjuries_ag
severeinjuries_ag %>%
leaflet() %>%
addProviderTiles("Stamen.TonerHybrid")
#plot events
p_load(leaflet)
p_load(leaflet.extras)
leaflet() %>%
addProviderTiles("Stamen.TonerHybrid") %>%
addHeatmap(data = severeinjuries_ag,
lng = ~Longitude, lat = ~Latitude,
radius = 15
)
?addHeatmap
leaflet() %>%
addProviderTiles("Stamen.TonerHybrid") %>%
addCSVHeatmap(data = severeinjuries_ag,
lng = ~Longitude, lat = ~Latitude,
radius = 15
)
browseURL(system.file("examples/KML.R", package = "leaflet.extras"))
leaflet() %>%
addBootstrapDependency() %>%
setView(-98.583333, 39.833333, 4) %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addKMLChoropleth(
kml,
valueProperty = JS(
"function(feature){
var props = feature.properties;
var aland = props.ALAND/100000;
var awater = props.AWATER/100000;
return 100*awater/(awater+aland);
}"),
scale = "OrRd", mode = "q", steps = 5,
padding = c(0.2, 0),
popupProperty = "description",
labelProperty = "NAME",
color = "#ffffff", weight = 1, fillOpacity = 1,
highlightOptions =
highlightOptions(fillOpacity = 1, weight = 2, opacity = 1, color = "#000000",
bringToFront = TRUE, sendToBack = TRUE),
legendOptions = legendOptions(
title = "% of Water Area",
numberFormatOptions = list(style = "decimal",
maximumFractionDigits = 2))
)
leaflet() %>%
addProviderTiles("Stamen.TonerHybrid") %>%
addCircleMarkers(data = severeinjuries_ag,
lng = ~Longitude, lat = ~Latitude,
radius = 15
)
